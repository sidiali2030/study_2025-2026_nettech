---
## Author
author:
  name: Бахи сиди али темассини
  degrees: Student (3 курс)
  orcid: ""
  email: 1032234211@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчёт по лабораторной работе №7"
subtitle: "Дисциплина: Сетевые технологии"
license: "CC BY"
---

## Цель работы

Получить навыки настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.

## Настройка DHCP в случае IPv4

1. В ходе выполнения работы были изменены отображаемые имена устройств в соответствии с заданным шаблоном: узел VPCS получил имя PC1-bahis, коммутатор — bahis-sw-01, маршрутизатор — bahis-gw-01. Захват трафика был включён на соединении между коммутатором bahis-sw-01 и маршрутизатором bahis-gw-01, что позволило зафиксировать и проанализировать сетевые пакеты, связанные с работой протокола DHCP ([рис. @fig-1]).

![Топология сети в GNS3 с переименованными устройствами и включённым захватом трафика](image/1.png){#fig-1 width=70%}



2. В режиме конфигурирования на маршрутизаторе было изменено имя устройства на bahis-gw-01 и задано доменное имя bahis.net. Далее был создан новый системный пользователь bahis с паролем для доступа к устройству, после чего конфигурация была применена и сохранена. Затем выполнен выход из системы и повторный вход под новым пользователем, что подтвердило корректность настроек. В завершение системный пользователь vyos, заданный по умолчанию, был удалён, а изменения сохранены, что обеспечило доступ к маршрутизатору только под учётной записью пользователя ([рис. @fig-2], [рис. @fig-3]).

![Настройка системных параметров VyOS: имя хоста, домен и создание пользователя](image/2.png){#fig-2 width=70%}

![Повторный вход под новым пользователем и удаление учётной записи vyos](image/2-1.png){#fig-3 width=70%}



4. На маршрутизаторе bahis-gw-01 была выполнена настройка DHCP-сервера. Создана разделяемая сеть (shared-network-name) с именем bahis, для которой задано доменное имя bahis.net и DNS-сервер 10.0.0.1. Для подсети 10.0.0.0/24 указан шлюз по умолчанию 10.0.0.1 и настроен диапазон выдаваемых IPv4-адресов 10.0.0.2–10.0.0.253. После применения (commit) и сохранения (save) конфигурации DHCP-сервер готов к автоматической выдаче сетевых параметров клиентам ([рис. @fig-5]).

![Конфигурация DHCP-сервера на маршрутизаторе VyOS для сети 10.0.0.0/24](image/4.png){#fig-5 width=70%}



5. Вывод команды show dhcp server statistics показывает, что для пула bahis настроен диапазон из 252 IPv4-адресов, при этом активных аренд (Leases) на данный момент нет. Все адреса пула доступны для выдачи, что подтверждается значением Available = 252 и нулевым процентом использования (Usage = 0%). Команда show dhcp server leases не отображает записей об арендах, что означает отсутствие клиентов, получивших IP-адреса по DHCP на момент проверки. Это подтверждает корректную работу DHCP-сервера и его готовность к выдаче адресов при обращении DHCP-клиентов ([рис. @fig-6]).

![Статистика DHCP-сервера и отсутствие активных аренд IP-адресов](image/5.png){#fig-6 width=70%}

6. Пояснение полученной информации на экране PC1

При выполнении команды ip dhcp -d на узле PC1 была использована опция -d, которая позволяет просматривать декодированные сообщения протокола DHCP, передаваемые между DHCP-клиентом и DHCP-сервером. В результате на экране был зафиксирован полный цикл работы протокола DHCP.

Сначала клиент, не имея IP-адреса (Client IP Address = 0.0.0.0), отправляет широковещательное сообщение DHCP DISCOVER с целью поиска доступного DHCP-сервера. В сообщении указывается MAC-адрес клиента и его имя хоста.

Далее DHCP-сервер отвечает сообщением DHCP OFFER, в котором предлагает клиенту свободный IP-адрес 10.0.0.2 и передаёт основные параметры сети: маску подсети, адрес шлюза по умолчанию, адрес DNS-сервера, доменное имя и время аренды адреса (lease time).

После получения предложения клиент отправляет сообщение DHCP REQUEST, подтверждая согласие на использование предложенного IP-адреса и запрашивая его у указанного DHCP-сервера.

В завершение сервер отправляет сообщение DHCP ACK, которым подтверждает успешную регистрацию адреса, резервирует его за клиентом на заданное время и завершает процесс настройки. В результате клиенту был успешно назначен IP-адрес 10.0.0.2/24 с шлюзом по умолчанию 10.0.0.1.

Таким образом, вывод команды ip dhcp -d на PC1 наглядно демонстрирует корректную работу DHCP-сервера и полный процесс автоматического получения сетевых параметров клиентом ([рис. @fig-6], [рис. @fig-7]).


![Завершение процесса DHCP: DHCP Request и DHCP ACK на узле PC1](image/6-1.png){#fig-7 width=70%}



7. Проверка сетевых параметров и связности на узле PC1

Команда show ip показала, что узлу PC1-bahis по протоколу DHCP корректно назначен IPv4-адрес 10.0.0.2/24, шлюз по умолчанию 10.0.0.1, DNS-сервер 10.0.0.1 и доменное имя bahis.net. Команда ping 10.0.0.1 -c 2 подтвердила успешную сетевую связность с маршрутизатором, так как оба ICMP-запроса получили ответы без потерь ([рис. @fig-8]).

![Результаты команды show ip и проверка связности с маршрутизатором с помощью ping](image/7.png){#fig-8 width=70%}



8. Пояснение информации, полученной на маршрутизаторе

После выполнения настройки DHCP-сервера на маршрутизаторе была проанализирована его работа с помощью команд show dhcp server statistics и show dhcp server leases.

Согласно выводу команды show dhcp server statistics, для пула адресов bahis был настроен диапазон, содержащий 252 IPv4-адреса. Первоначально количество активных аренд (Leases) было равно 0, что означало отсутствие DHCP-клиентов, получивших адреса. Все адреса пула находились в состоянии Available, а процент использования составлял 0%.

После выполнения команды ip dhcp -d на узле PC1 и успешного получения сетевых параметров по DHCP, статистика DHCP-сервера изменилась. Количество активных аренд увеличилось до 1, а число доступных адресов уменьшилось до 251, что подтверждает корректную выдачу одного IP-адреса клиенту.

Команда show dhcp server leases отобразила подробную информацию о выданной аренде. DHCP-клиенту с MAC-адресом 00:50:79:66:68:00 был назначен IP-адрес 10.0.0.2, который находится в состоянии active. В таблице также указаны время начала аренды, время её окончания и оставшееся время действия аренды. В поле Hostname отображается имя клиента PC1-bahis, что подтверждает идентификацию узла, получившего адрес ([рис. @fig-9]).

![Статистика DHCP-сервера и информация о выданной аренде на маршрутизаторе](image/8.png){#fig-9 width=70%}


9. Анализ журнала DHCP-сервера

Анализ журнала DHCP-сервера показал корректную работу службы DHCP на маршрутизаторе. В журнале зафиксирован полный процесс обслуживания клиента PC1: получение сообщения DHCPDISCOVER, отправка предложения DHCPOFFER с адресом 10.0.0.2, приём запроса DHCPREQUEST и подтверждение выдачи адреса сообщением DHCPACK. Все сообщения были обработаны через интерфейс eth0, что соответствует настроенной подсети 10.0.0.0/24. Повторные записи DHCPREQUEST и DHCPACK свидетельствуют о продлении существующей аренды адреса. Таким образом, журнал подтверждает успешную выдачу и обслуживание IPv4-адреса DHCP-клиенту ([рис. @fig-10]).

![Фрагмент журнала DHCP-сервера VyOS с записями DHCPDISCOVER, DHCPOFFER, DHCPREQUEST и DHCPACK](image/9.png){#fig-10 width=70%}

10. Краткий анализ захваченных пакетов

В захваченном трафике зафиксирован полный процесс назначения IPv4-адреса по протоколу DHCP. Сначала узел отправляет широковещательное сообщение DHCP Discover (0.0.0.0 → 255.255.255.255), после чего DHCP-сервер отвечает сообщением DHCP Offer с предложением адреса 10.0.0.2. Далее клиент подтверждает выбор адреса сообщением DHCP Request, и сервер завершает процесс сообщением DHCP ACK, резервируя адрес за клиентом.

После получения адреса наблюдаются ARP-пакеты (в том числе gratuitous ARP), которые используются для проверки уникальности IP-адреса и обновления ARP-таблиц. Также в трафике присутствуют ICMP Echo request / Echo reply, подтверждающие успешную сетевую связность между узлом и маршрутизатором.

Таким образом, анализ трафика подтверждает корректную работу DHCP-сервера и успешное назначение IP-адреса клиентскому устройству ([рис. @fig-11], [рис. @fig-12]).

![Захваченный трафик в Wireshark: DHCP Discover, Offer, Request и ACK](image/10.png){#fig-11 width=70%}

![Детализация DHCP- и ARP-пакетов в анализаторе трафика Wireshark](image/10-1.png){#fig-12 width=70%}

## Настройка DHCP в случае IPv6


11. Использование Alpine Linux и топологии сети

Использован Alpine Linux, так как VPCS не поддерживает работу по протоколу DHCPv6.

Имена устройств были изменены по заданному шаблону (bahis-gw-0x, bahis-sw-0x, PC1-bahis), что упростило идентификацию элементов сети.

На соединениях между маршрутизатором gw-01 и коммутаторами sw-02 и sw-03 был включён захват трафика для анализа обмена ICMPv6 и DHCPv6 ([рис. @fig-13]).

![Топология сети IPv6 в GNS3 с использованием Alpine Linux и включённым захватом трафика](image/11.png){#fig-13 width=70%}



12. Настройка системных параметров VyOS

На маршрутизаторе выполнен переход в режим конфигурирования VyOS. Было изменено имя устройства на bahis-gw-01 и задано доменное имя bahis.net.

Создан новый системный пользователь bahis с заданным паролем для доступа к устройству. После применения конфигурации (commit) и сохранения настроек (save) была выполнена повторная авторизация под новым пользователем, что подтверждает корректность изменений.

Таким образом, стандартный пользователь был заменён пользовательской учётной записью, а параметры системы успешно применены ([рис. @fig-14]).

![Настройка имени хоста, доменного имени и создание пользователя в VyOS](image/12.png){#fig-14 width=70%}



13. Назначение IPv6-адресов интерфейсам маршрутизатора

Интерфейсу eth1 назначен IPv6-адрес 2000::1/64, а интерфейсу eth2 — IPv6-адрес 2001::1/64, что соответствует заданным подсетям.

Команда show interfaces подтверждает корректное назначение адресов и аппаратных идентификаторов интерфейсов. После выполнения команд commit и save конфигурация успешно применена и сохранена ([рис. @fig-15]).

![Назначение IPv6-адресов интерфейсам eth1 и eth2 и вывод команды show interfaces](image/13.png){#fig-15 width=70%}



14. Настройка Stateless DHCPv6 и Router Advertisement

На маршрутизаторе настроена DHCPv6-конфигурация без отслеживания состояния (Stateless DHCPv6) для интерфейса eth1.

С помощью механизма Router Advertisements (RA) на интерфейсе eth1 объявлен префикс 2000::/64, что позволяет узлам автоматически формировать IPv6-адреса с использованием SLAAC. Установка флага other-config-flag указывает хостам, что дополнительные параметры сети (DNS, домен) необходимо получать через DHCPv6, без выдачи IPv6-адресов сервером DHCPv6.

Также создана разделяемая сеть bahis-stateless, в которой заданы общие параметры (common-options): DNS-сервер 2000::1 и доменное имя bahis.net. Конфигурация успешно применена и сохранена ([рис. @fig-16], [рис. @fig-17]).

![Настройка Router Advertisement и Stateless DHCPv6 на интерфейсе eth1](image/14-1.png){#fig-16 width=70%}

![Просмотр итоговой конфигурации DHCPv6 и RA в VyOS](image/14-2.png){#fig-17 width=70%}



15. Проверка IPv6-адресации и связности на узле PC2

Узел PC2 получил глобальный IPv6-адрес 2000::42:9bff:febb:db00/64, сформированный автоматически с использованием SLAAC, а также link-local адрес fe80::/64.

Таблица маршрутизации подтверждает наличие маршрута к сети 2000::/64 и шлюза по умолчанию через link-local адрес маршрутизатора. Проверка связности командой ping 2000::1 показала успешный обмен ICMPv6-пакетами.

Попытка получения адреса по DHCPv6 завершилась сообщением об отсутствии опции IAADDR, что соответствует режиму Stateless DHCPv6. Связность при этом сохраняется ([рис. @fig-18], [рис. @fig-19], [рис. @fig-20]).

![Проверка IPv6-адресации и маршрутизации на узле PC2](image/15-1.png){#fig-18 width=70%}

![Результаты попытки получения параметров по DHCPv6 на узле PC2](image/15-2.png){#fig-19 width=70%}



16. Анализ захваченного IPv6-трафика

В захваченном трафике наблюдается корректная работа механизмов IPv6 SLAAC и Stateless DHCPv6. Узел PC2 отправляет ICMPv6 Router Solicitation, после чего маршрутизатор отвечает сообщениями Router Advertisement с объявлением префикса и параметров сети.

Также зафиксированы сообщения DHCPv6 Solicit, Advertise и Reply, содержащие дополнительные параметры конфигурации без опции IAADDR. Сообщения ICMPv6 Destination Unreachable (Port unreachable) являются допустимыми служебными сообщениями и не указывают на ошибку конфигурации ([рис. @fig-21]).

![Захваченный трафик ICMPv6 и DHCPv6 Stateless в Wireshark](image/16.png){#fig-21 width=70%}


17. Настройка Stateful DHCPv6 на маршрутизаторе

На маршрутизаторе настроена DHCPv6-конфигурация с отслеживанием состояния (Stateful DHCPv6) для интерфейса eth2.

С помощью параметра managed-flag в сообщениях Router Advertisement (RA) узлам сети указывается, что IPv6-адреса и параметры конфигурации должны получаться через DHCPv6-сервер, а не формироваться только с помощью SLAAC.

На маршрутизаторе создана разделяемая сеть bahis-stateful с подсетью 2001::/64. DHCPv6-серверу задан диапазон адресов 2001::100 – 2001::199, из которого осуществляется выдача IPv6-адресов клиентам. Также настроены дополнительные параметры конфигурации: DNS-сервер 2001::1 и доменное имя bahis.net.

После выполнения команд commit и save конфигурация была успешно применена и сохранена. В отличие от Stateless-режима, в данном случае DHCPv6-сервер отслеживает выданные адреса и отображает их в таблице аренд ([рис. @fig-22]).

![Конфигурация Stateful DHCPv6 на маршрутизаторе VyOS для подсети 2001::/64](image/17.png){#fig-22 width=70%}



19. Проверка параметров IPv6 на узле PC3 после DHCPv6

На узле PC3 после получения адреса по DHCPv6 (stateful) был назначен глобальный IPv6-адрес из диапазона 2001::100–2001::199, а также link-local адрес.

В таблице маршрутизации присутствует маршрут по умолчанию, полученный через Router Advertisement с флагом managed-flag, что подтверждает корректную работу DHCPv6 с отслеживанием состояния.

Проверка связности с маршрутизатором командой ping 2001::1 завершилась успешно. Файл /etc/resolv.conf содержит DNS-сервер 2001::1 и домен bahis.net, полученные от DHCPv6-сервера. На маршрутизаторе команда show dhcpv6 server leases подтверждает наличие активной аренды IPv6-адреса ([рис. @fig-25], [рис. @fig-26]).

![Проверка IPv6-адресации и маршрутизации на узле PC3](image/19-1.png){#fig-25 width=70%}




20. Анализ результатов DHCPv6 (Stateful)

На узле PC3 после выполнения команды udhcpc6 -i eth0 был успешно получен глобальный IPv6-адрес из диапазона 2001::100–2001::199, а также автоматически назначены параметры DNS (2001::1) и domain-search (bahis.net). В таблице маршрутизации появился маршрут по умолчанию через маршрутизатор. Успешный ping 2001::1 подтверждает корректную настройку IPv6-адресации и маршрутизации.

На маршрутизаторе команда run show dhcpv6 server leases показывает активную аренду IPv6-адреса, что подтверждает работу DHCPv6 с отслеживанием состояния (Stateful).

В захваченном трафике анализатором наблюдается стандартная последовательность работы DHCPv6: Router Solicitation, Router Advertisement с флагом managed, далее сообщения Solicit → Advertise → Request → Reply, после чего узлу назначается IPv6-адрес и сетевые параметры ([рис. @fig-27]).

![Захваченный трафик DHCPv6 Stateful и ICMPv6 в анализаторе Wireshark](image/20.png){#fig-27 width=70%}


## Выводы

В ходе выполнения лабораторной работы была успешно реализована и исследована настройка автоматической адресации IPv6 с использованием протокола DHCPv6 в двух режимах: без отслеживания состояния (stateless) и с отслеживанием состояния (stateful).

На интерфейсе eth1 маршрутизатора был настроен режим DHCPv6 Stateless, при котором узел PC2 получил IPv6-адрес с помощью механизма SLAAC, а дополнительные параметры сети (DNS-сервер и доменное имя) были получены по протоколу DHCPv6. Это подтверждается отсутствием записей о выданных адресах в таблице аренды DHCPv6 на маршрутизаторе и корректной работой DNS.

На интерфейсе eth2 маршрутизатора был настроен режим DHCPv6 Stateful, при котором узел PC3 получил IPv6-адрес из заданного диапазона 2001::100 – 2001::199, а также параметры DNS от DHCPv6-сервера. Назначение адреса подтверждается записями в таблице аренды DHCPv6 и успешной проверкой сетевой связности с маршрутизатором.

Анализ захваченного сетевого трафика показал корректную работу протоколов ICMPv6, Router Advertisement, Neighbor Discovery и DHCPv6, а также последовательность обмена сообщениями Solicit, Advertise, Request и Reply при получении адреса по DHCPv6.

Таким образом, все поставленные в задании цели были достигнуты: выполнена настройка IPv6-адресации, реализованы оба режима DHCPv6, подтверждена их корректная работа и проанализировано взаимодействие сетевых устройств на уровне протоколов.